# いまなにしてる？

「いまなにしてる？」タイムラインアプリ - ローカル開発環境

## 概要

「いまなにしてる？」は、ユーザーが現在の行動や気持ちを共有するタイムラインアプリです。
ローカル開発環境では、Node.jsサーバーとSQLiteデータベースを使用します。

## 環境要件

- Node.js v22.x
- npm

## セットアップ

### 1. 依存パッケージのインストール

```bash
cd src
npm install
```

### 2. サーバーの起動

```bash
npm start
```

サーバーが起動したら、ブラウザで以下のURLにアクセスしてください：

```
http://localhost:3000
```

## 開発サーバーの使い方

### サーバー起動

```bash
npm start
```

または

```bash
node server.js
```

### サーバー停止

サーバーが起動中に `Ctrl+C` を押すとサーバーが停止します。

### サーバー再起動

サーバーを停止してから、再度 `npm start` を実行してください。

再起動後も、SQLiteデータベースに保存されたデータは引き継がれます。

## データベース

### 場所

データベースファイルは `src/database.sqlite` に作成されます。

### スキーマ

- **users**: ユーザー情報
  - id: ユーザーID
  - username: ユーザー名
  - created_at: 作成日時

- **posts**: 投稿データ
  - id: 投稿ID
  - user_id: ユーザーID（外部キー）
  - username: ユーザー名
  - content: 投稿内容（50文字以内）
  - created_at: 作成日時

### データリセット

データベースをリセットしたい場合は、`src/database.sqlite` ファイルを削除してください。

## 機能

### ログイン

- パスワード不要
- 初回ログイン時に名前を入力
- クッキーでログイン状態を保持（30日間）

### タイムライン

- 最新の投稿を上に表示
- 最新1000件まで表示
- 3秒おきに自動更新（新しい投稿をチェック）

### 投稿

- 50文字以内で投稿可能
- Enterキーで投稿
- 投稿後、タイムラインに自動反映

### ログアウト

- ヘッダーの「ログアウト」ボタンからログアウト可能
- ログアウト後、再度ログインが必要

## API エンドポイント

- `POST /api/login` - ログイン
- `GET /api/auth/check` - ログイン状態確認
- `GET /api/timeline` - タイムライン取得
- `GET /api/timeline/new` - 新規投稿取得（ポーリング用）
- `POST /api/posts` - 投稿作成
- `POST /api/logout` - ログアウト

## トラブルシューティング

### サーバーが起動しない

- Node.js v22がインストールされているか確認
- ポート3000が使用されていないか確認
- `npm install` が完了しているか確認

### データが表示されない

- ブラウザの開発者ツールでコンソールエラーを確認
- サーバーのログを確認
- データベースファイルが正しく作成されているか確認

## 開発メモ

- データベースは SQLite（sqlite3）を使用
- サーバーは Express で構築
- フロントエンドはクッキーベースの認証を使用
- ポーリング間隔は3秒

## パッケージ構成

- **express**: Webサーバー
- **sqlite3**: SQLiteデータベース
- **body-parser**: リクエストボディパース
- **cookie-parser**: クッキー管理

## 注意事項

- このプロジェクトはsqlite3を使用しています（Node.js 24との互換性のため）

